<!DOCTYPE html>
<html lang="en">
<head>

<!-- FONT AWESOME -->
 <!-- FONT AWESOME - VERSI YANG LEBIH SIMPLE -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- GOOGLE FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">


<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Smart Room Dashboard</title>

<style>
    body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: url('assets/kamarku.jpg') center/cover fixed;
        color: white;
    }

    .overlay {
        background: rgba(0,0,0,0.55);
        width: 100%;
        height: 100%;
        position: fixed;
        inset: 0;
        z-index: -1;
        backdrop-filter: blur(3px);
    }

    .container {
        max-width: 760px;
        margin: 40px auto;
        padding: 20px;
    }

    h1 {
        text-align: center;
        font-weight: 700;
        margin-bottom: 35px;
        letter-spacing: 1px;
        font-size: 32px;
        text-shadow: 0 0 15px rgba(255,255,255,0.3);
    }

    /* KARTU GLASS */
    .card {
        backdrop-filter: blur(18px);
        background: rgba(255,255,255,0.11);
        padding: 25px;
        border-radius: 18px;
        margin-bottom: 22px;
        box-shadow: 0 0 25px rgba(0,0,0,0.35);
        transition: 0.3s;
    }
    .card:hover {
        transform: translateY(-2px);
        background: rgba(255,255,255,0.15);
    }

    .sensor-title {
        text-align: center;
        font-size: 18px;
        margin-bottom: 15px;
        opacity: 0.9;
    }

    /* SUHU & HUMIDITY */
    .sensor-box {
        font-size: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
    }

    /* ICON SENSOR */
    .icon {
        width: 28px;
        margin-right: 10px;
        opacity: 0.85;
    }

    /* LAYOUT RUANGAN */
    .room-visual {
        width: 100%;
        height: 170px;
        border-radius: 15px;
        background: url('assets/cover.jpg') center/cover;
        margin-bottom: 18px;
        box-shadow: 0 0 20px rgba(0,0,0,0.45);
        position: relative;
    }

    /* Toggle aesthetic */
    .toggle-button {
        width: 58px;
        height: 28px;
        border-radius: 40px;
        background: #666;
        position: relative;
        cursor: pointer;
        transition: .25s ease-in-out;
    }

    .toggle-circle {
        width: 24px;
        height: 24px;
        background: white;
        border-radius: 50%;
        position: absolute;
        top: 2px;
        left: 3px;
        transition: 0.28s ease;
        box-shadow: 0 3px 10px rgba(0,0,0,0.3);
    }

    .toggle-button.active {
        background: #4ade80;
        box-shadow: 0 0 12px #4ade80aa;
    }
    .toggle-button.active .toggle-circle {
        left: 31px;
    }

    /* LABEL lampu / kipas */
    .label {
        display: flex;
        align-items: center;
        gap: 10px;
    }
</style>
</head>

<body>

<div class="overlay"></div>

<div class="container">
    <h1>Eciâ€™s Smart Room âœ¨</h1>

    <!-- Room Visual -->
    <div class="room-visual"></div>

    <!-- Sensor Card -->
    <div class="card">
        <div class="sensor-title">ðŸ“¡ Real-time Sensor</div>

        <div class="sensor-box">
            <span class="label">
                <i class="fa-solid fa-temperature-half"></i> Suhu
            </span>
            <span id="temp">-- Â°C</span>
        </div>

        <div class="sensor-box">
            <span class="label">
                <i class="fa-solid fa-droplet"></i> Kelembapan
            </span>
            <span id="hum">-- %</span>
        </div>
    </div>

    <!-- Relay Controls -->
    <div class="card">
        <div class="sensor-title">ðŸ’¡ Kontrol Perangkat</div>

        <div class="sensor-box">
            <span>
                <i class="fa-solid fa-fan"></i> Kipas
            </span>

            <div class="toggle-button" id="relayKipas">
                <div class="toggle-circle"></div>
            </div>
        </div>

        <div class="sensor-box">
            <span class="label">
                <i class="fa-solid fa-lightbulb"></i> Lampu Utama
            </span>
            <div class="toggle-button" id="relayL1">
                <div class="toggle-circle"></div>
            </div>
        </div>

        <div class="sensor-box">
            <span class="label">
                <i class="fa-solid fa-book"></i> Lampu Belajar
            </span>
            <div class="toggle-button" id="relayL2">
                <div class="toggle-circle"></div>
            </div>
        </div>

        <div class="sensor-box">
            <span class="label">
                <i class="fa-solid fa-moon"></i> Lampu Tidur
            </span>
            <div class="toggle-button" id="relayL3">
                <div class="toggle-circle"></div>
            </div>
        </div>
    </div>
</div>

<!-- SCRIPT TIDAK DIUBAH SAMA SEKALI -->
<script>
const BASE = "http://192.168.43.6";

// Update sensor & tombol
async function updateSensor() {
    try {
        const res = await fetch(BASE + "/status");
        const data = await res.json();

        document.getElementById("temp").textContent = data.temperature + " Â°C";
        document.getElementById("hum").textContent = data.humidity + " %";

        setToggleState("relayKipas", data.fan);
        setToggleState("relayL1", data.utama);
        setToggleState("relayL2", data.belajar);
        setToggleState("relayL3", data.tidur);
    } catch(e) {
        console.log("Gagal fetch sensor:", e);
    }
}

function setToggleState(id, state){
    const el = document.getElementById(id);
    if(state && !el.classList.contains("active")) el.classList.add("active");
    if(!state && el.classList.contains("active")) el.classList.remove("active");
}

function setupToggle(id, onEndpoint, offEndpoint) {
    const el = document.getElementById(id);
    el.onclick = async () => {
        const isActive = el.classList.contains("active");
        const endpoint = isActive ? offEndpoint : onEndpoint;
        try {
            await fetch(BASE + endpoint);
            await updateSensor();
        } catch(e) {
            console.log("Error toggle:", e);
        }
    };
}

setupToggle("relayKipas", "/fan/on", "/fan/off");
setupToggle("relayL1", "/utama/on", "/utama/off");
setupToggle("relayL2", "/belajar/on", "/belajar/off");
setupToggle("relayL3", "/tidur/on", "/tidur/off");

setInterval(updateSensor, 2000);
updateSensor();
</script>

</body>
</html>
